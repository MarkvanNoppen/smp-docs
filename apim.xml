<!--
theta.co.nz/cyber
security@theta.co.nz
first.last@theta.co.nz
-->
<policies>
    <inbound>
        <base />
    </inbound>
    <backend>
        <base />
    </backend>
    <outbound>
        <base />
    </outbound>
    <on-error>
        <base />
    </on-error>
</policies>

<!--
the below block fetch target credentials from a keyvault and set them as a variable using a managed identity
replace KEYVAULT_NAME & SECRET_NAME accordingly

<send-request mode="new" response-variable-name="keyvault_request" timeout="20" ignore-error="false">
    <set-url>https://KEYVAULT_NAME.vault.azure.net/secrets/SECRET_NAME/?api-version=2016-10-01</set-url>
    <set-method>GET</set-method>
    <authentication-managed-identity resource="https://vault.azure.net" />
</send-request>

<set-variable name="keyvault_secret" value="@(((IResponse)context.Variables["keyvault_request"]).Body.As<JObject>()["value"].ToString())" />
-->
